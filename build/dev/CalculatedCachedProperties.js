/**
* calculated-cached-properties https://github.com/anodynos/calculated-cached-properties
*
* CalculatedCachedProperties allows properties to have values calculated by a function, and then cached. You can then manually invalidate (clean) the cache for one or more (or all) properties, forcing the function to be invoked and recalculate next time the property is accessed. You can also set the value of a property manually. Undefined / null etc are all valid property values. Works with POJSOs, JS constructors and CoffeeScript classes (i.e `MyClass extends CalculatedCachedProperties`, and then just call `super` constructor). A spinoff from uBerscore library. Docs will follow, see the specs till then :-)
* Version 0.2.2 - Compiled on 2015-07-17 10:44:53
* Repository git://github.com/anodynos/calculated-cached-properties
* Copyright(c) 2015 Angelos Pikoulas <agelos.pikoulas@gmail.com>
* License MIT http://www.opensource.org/licenses/mit-license.php
*/

// Generated by uRequire v0.7.0-beta.20 target: 'dev' template: 'UMDplain'
(function () {
  
var __isAMD = !!(typeof define === 'function' && define.amd),
    __isNode = (typeof exports === 'object'),
    __isWeb = !__isNode;
(function (factory) {
  var rootExport = function (root, __umodule__) {
  if (!__isAMD && !__isNode) {root['CalculatedCachedProperties'] = __umodule__;

}return __umodule__;
};
if (typeof exports === 'object') {
    module.exports = rootExport(global, factory(require, exports, module));
} else if (typeof define === 'function' && define.amd) { define(['require', 'exports', 'module'], function (require, exports, module) {
  return rootExport(window, factory(require, exports, module));
}); } else {
var _require = function(modyle){
  throw new Error("uRequire: Loading UMD module as <script>, failed to `require('" + modyle + "')`: reason unexpected !");
}, _exports = {}, _module = {exports: _exports};
rootExport(window, factory(_require, _exports, _module));;
}
}).call(this, function (require, exports, module) {
  

var VERSION = '0.2.2'; // injected by urequire-rc-inject-version

var CalculatedCachedProperties, _, __slice = [].slice;
_ = {
  extend: function (target, source) {
    var key;
    for (key in source) {
      target[key] = source[key];
    }
  },
  defaults: function (target, source) {
    var key;
    for (key in source) {
      if (!target.hasOwnProperty(key)) {
        target[key] = source[key];
      }
    }
  },
  keys: function (obj) {
    var key, _results;
    _results = [];
    for (key in obj) {
      _results.push(key);
    }
    return _results;
  },
  isFunction: function (f) {
    return typeof f === "function";
  }
};
CalculatedCachedProperties = function () {
  var cUndefined, cacheKey, prefix;
  CalculatedCachedProperties.VERSION = VERSION;
  prefix = function (prop) {
    return "__$$_CCP_" + prop;
  };
  cacheKey = prefix("cache");
  cUndefined = { "CalculatedCachedProperties Undefined": true };
  CalculatedCachedProperties.register = function (pojsoOrConstructor, calcProperties, options) {
    var classConstructor, ctor, pojso;
    if (options == null) {
      options = CalculatedCachedProperties.optionsDefaults;
    }
    if (options !== CalculatedCachedProperties.optionsDefaults) {
      _.defaults(options || (options = {}), CalculatedCachedProperties.optionsDefaults);
    }
    if (_.isFunction(pojsoOrConstructor)) {
      classConstructor = pojsoOrConstructor;
      _.extend(classConstructor.prototype, CalculatedCachedProperties.prototype);
      _.extend(classConstructor.CCP_calcProperties || (classConstructor.CCP_calcProperties = {}), calcProperties);
      classConstructor.prototype._CCP_defineCalcProperties(options);
    } else {
      pojso = pojsoOrConstructor;
      _.extend(pojso.__proto__ = {}, CalculatedCachedProperties.prototype);
      pojso.constructor = ctor = function () {
      };
      ctor.prototype = pojso.__proto__;
      _.extend(ctor.prototype, CalculatedCachedProperties.prototype);
      _.extend(ctor.CCP_calcProperties || (ctor.CCP_calcProperties = {}), calcProperties);
      pojso._CCP_defineCalcProperties(options);
    }
    return pojsoOrConstructor;
  };
  CalculatedCachedProperties.prototype.CCP_getClasses = function (instOrClass, _classes) {
    if (_classes == null) {
      _classes = [];
    }
    if (!instOrClass) {
      instOrClass = this;
    }
    if (!_.isFunction(instOrClass)) {
      instOrClass = instOrClass.constructor;
    }
    _classes.unshift(instOrClass);
    if (instOrClass.__super__) {
      return this.CCP_getClasses(instOrClass.__super__.constructor, _classes);
    } else {
      return _classes;
    }
  };
  CalculatedCachedProperties.CCP_getClasses = CalculatedCachedProperties.prototype.CCP_getClasses;
  CalculatedCachedProperties.prototype.CCP_getAllCalcProperties = function (instOrClass) {
    var aClass, cFunct, cProp, calcProps, _i, _len, _ref, _ref1;
    if (instOrClass == null) {
      instOrClass = this;
    }
    calcProps = {};
    _ref = this.CCP_getClasses(instOrClass);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      aClass = _ref[_i];
      _ref1 = aClass.CCP_calcProperties;
      for (cProp in _ref1) {
        cFunct = _ref1[cProp];
        calcProps[cProp] = cFunct;
      }
    }
    return calcProps;
  };
  CalculatedCachedProperties.CCP_getAllCalcProperties = CalculatedCachedProperties.prototype.CCP_getAllCalcProperties;
  Object.defineProperties(CalculatedCachedProperties.prototype, {
    CCP_allCalcProperties: {
      get: function () {
        if (!this.constructor.prototype.hasOwnProperty("_allCalcProperties")) {
          Object.defineProperty(this.constructor.prototype, "_allCalcProperties", {
            value: this.CCP_getAllCalcProperties(),
            enumerable: false
          });
        }
        return this.constructor.prototype._allCalcProperties;
      }
    },
    CCP_classes: {
      get: function () {
        if (!this.constructor.prototype.hasOwnProperty("_classes")) {
          Object.defineProperty(this.constructor.prototype, "_classes", {
            value: this.CCP_getClasses(),
            enumerable: false
          });
        }
        return this.constructor.prototype._classes;
      }
    }
  });
  function CalculatedCachedProperties() {
    var args, _ref;
    args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    this._CCP_defineCalcProperties((_ref = args[args.length - 1]) != null ? _ref.CCP_options : void 0);
  }
  CalculatedCachedProperties.prototype._CCP_initCache = function () {
    var cPropFn, cPropName, _ref;
    if (this.constructor.isDebug(30)) {
      console.log("CalculatedCachedProperties: Initializing cache for calculated properties of constructor named `" + (this.constructor.name || "UNNAMED") + "`");
    }
    Object.defineProperty(this, cacheKey, {
      value: {},
      enumerable: true,
      configurable: false,
      writeable: false
    });
    _ref = this.CCP_allCalcProperties || this.CCP_getAllCalcProperties();
    for (cPropName in _ref) {
      cPropFn = _ref[cPropName];
      this[cacheKey][cPropName] = cUndefined;
    }
  };
  CalculatedCachedProperties.prototype._CCP_defineCalcProperties = function (options) {
    var cPropFn, cPropName, _ref;
    if (options == null) {
      options = {};
    }
    this.constructor.isDebug = function (lev) {
      return options.debugLevel >= lev;
    };
    if (this.constructor.isDebug(10)) {
      console.log("CalculatedCachedProperties: options {} for " + (this.constructor.name || "UNNAMED"), options);
    }
    _ref = this.CCP_allCalcProperties || this.CCP_getAllCalcProperties();
    for (cPropName in _ref) {
      cPropFn = _ref[cPropName];
      if (!this.constructor.prototype.hasOwnProperty(cPropName) || options.isOverwrite) {
        (function (_this) {
          return function (cPropName, cPropFn) {
            if (_this.constructor.isDebug(20)) {
              console.log("CalculatedCachedProperties: DEFINE calculated property " + (_this.constructor.name || "UNNAMED") + "." + cPropName);
            }
            return Object.defineProperty(_this.constructor.prototype, cPropName, {
              enumerable: true,
              configurable: true,
              get: function () {
                var result;
                if (!this[cacheKey]) {
                  this._CCP_initCache();
                }
                if (this[cacheKey][cPropName] === cUndefined) {
                  if (this.constructor.isDebug(40)) {
                    console.log("CalculatedCachedProperties: CALCULATING & CACHING property " + (this.constructor.name || "UNNAMED") + "." + cPropName);
                  }
                  result = cPropFn.call(this);
                  if (this.constructor.isDebug(80)) {
                    if (!this.constructor.isDebug(1000)) {
                      console.log("CalculatedCachedProperties: calculated value of " + (this.constructor.name || "UNNAMED") + "." + cPropName + " :", result);
                    }
                  }
                  this[cacheKey][cPropName] = result;
                }
                if (this.constructor.isDebug(100)) {
                  console.log("CalculatedCachedProperties: GET value of calculated property " + (this.constructor.name || "UNNAMED") + "." + cPropName, this.constructor.isDebug(1000) ? this[cacheKey][cPropName] : "");
                }
                return this[cacheKey][cPropName];
              },
              set: function (v) {
                if (!this[cacheKey]) {
                  this._CCP_initCache();
                }
                if (this.constructor.isDebug(50)) {
                  console.log("CalculatedCachedProperties: SET value of property " + (this.constructor.name || "UNNAMED") + "." + cPropName);
                }
                return this[cacheKey][cPropName] = v;
              }
            });
          };
        }(this)(cPropName, cPropFn));
      }
    }
  };
  CalculatedCachedProperties.prototype.CCP_clean = function () {
    var ca, cleanArgs, cleaned, p, propKeys, _i, _j, _len, _len1;
    cleanArgs = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    if (!_.isFunction(this.constructor.isDebug)) {
      this._CCP_defineCalcProperties();
    }
    if (cleanArgs.length === 0) {
      cleanArgs = _.keys(this.CCP_allCalcProperties || this.CCP_getAllCalcProperties());
    }
    cleaned = [];
    for (_i = 0, _len = cleanArgs.length; _i < _len; _i++) {
      ca = cleanArgs[_i];
      if (ca) {
        if (_.isFunction(ca)) {
          if (!propKeys) {
            propKeys = _.keys(this.CCP_allCalcProperties || this.CCP_getAllCalcProperties());
          }
          for (_j = 0, _len1 = propKeys.length; _j < _len1; _j++) {
            p = propKeys[_j];
            if (!ca(p)) {
              continue;
            }
            if (this.constructor.isDebug(60)) {
              console.log("CalculatedCachedProperties: CLEAN (via function) value of property " + (this.constructor.name || "UNNAMED") + "." + p);
            }
            if (!this[cacheKey]) {
              this._CCP_initCache();
            } else {
              this[cacheKey][p] = cUndefined;
            }
            cleaned.push(p);
          }
        } else {
          if (this.constructor.isDebug(60)) {
            console.log("CalculatedCachedProperties: CLEAN value of property " + (this.constructor.name || "UNNAMED") + "." + ca);
          }
          if (!this[cacheKey]) {
            this._CCP_initCache();
          } else {
            this[cacheKey][ca] = cUndefined;
          }
          cleaned.push(ca);
        }
      }
    }
    return cleaned;
  };
  return CalculatedCachedProperties;
}();
CalculatedCachedProperties.optionsDefaults = {
  isOverwrite: false,
  debugLevel: 0
};
module.exports = CalculatedCachedProperties;

return module.exports;

});
}).call(this);